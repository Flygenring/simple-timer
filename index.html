<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Simple Timer</title>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="shortcut icon" href="favicon.ico">

    <style>
        body {padding:20px;}
        #clock { margin: 0 auto; }
        path.color0 { fill: white; }
        path.color1 { fill: red; }
    </style>
</head>
<body>

<a href="https://github.com/mathiasverraes/simple-timer"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/652c5b9acfaddf3a9c326fa6bde407b87f7be0f4/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"></a>

<div class="btn-group">
    <button type="button" class="btn btn-default" onclick="runTimer(1)">1 minute</button>
    <button type="button" class="btn btn-default" onclick="runTimer(3)">3 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(5)">5 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(7)">7 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(10)">10 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(15)">15 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(20)">20 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(25)">25 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(30)">30 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(45)">45 minutes</button>
    <button type="button" class="btn btn-default" onclick="runTimer(60)">60 minutes</button>
</div>

<div id="clock"></div>
<audio src="alarm.mp3" id="beep" autostart="false"></audio>

<script>
    var timeoutID;

    function ringAlarm() {
        document.getElementById('beep').play();
    }

    function clearNode(node) {
        while (node.hasChildNodes()) {
            node.removeChild(node.lastChild);
        }
    }

    function runTimer(durationinMinutes) {
        
        ga('send', {
          'hitType': 'event',          
          'eventCategory': 'Start timer',   
          'eventAction': 'Duration: '+durationinMinutes+'min',
          'eventLabel': 'Button',
          'eventValue': durationinMinutes
        });
        
        durationinSeconds = durationinMinutes * 60;
        
        clearTimeout(timeoutID);
        clearNode(document.getElementById('clock'));


        var element = '#clock';
        var width = window.innerWidth * .9;
        var height = window.innerHeight * .9;
        var radius = Math.min(width, height) / 2;
        var pie = d3.layout.pie().sort(null);

        var arc = d3.svg.arc()
                .innerRadius(radius/4)
                .outerRadius(radius);
        var svg = d3.select(element).append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
        var path = svg.selectAll("path");


        function update(data) {
            var pathData = path.data(pie(data));
            pathData
                    .enter()
                    .append("path")
                    .attr("class", function (d, i) {
                        return "color" + i;
                    })
                    .attr("d", arc)
            ;
        }


        /**
         *
         * @param timerDuration
         * @param timePassed
         * @returns {number}
         */
        function loop(timerDuration, timePassed) {
            return setTimeout(function () {
                var leftoverTime = timerDuration - timePassed;
                update([timerDuration - leftoverTime, leftoverTime]);

                if (timePassed < timerDuration) {
                    loop(timerDuration, ++timePassed)
                } else {
                    ringAlarm();
                }

            }, 1000);
        }


        timeoutID = loop(durationinSeconds, 0);
    }


</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-2620608-12', 'auto');
  ga('send', 'pageview');

</script>

</body>
</html>
